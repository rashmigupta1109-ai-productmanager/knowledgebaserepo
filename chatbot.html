<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chatbot</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#f8f9fa; }
    .chat-window { height: 60vh; overflow-y:auto; padding:15px; background:white; border-radius: .5rem; }
    .message { margin-bottom: .75rem; }
    .msg-user { text-align:right; }
    .msg-bot { text-align:left; }
  </style>
</head>
<body>
<div class="container py-4">
  <h1 class="mb-4">Chatbot</h1>
  <div id="chat" class="chat-window border">
    <!-- messages -->
  </div>

  <form id="chatForm" class="row g-2 mt-3">
    <div class="col-12">
      <label for="messageInput" class="form-label">Enter description or question</label>
      <input type="text" id="messageInput" class="form-control" placeholder="Type your question or description and press Enter or Submit" autocomplete="off">
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-primary">Send</button>
    </div>
    <div class="col-auto">
      <button type="button" id="clearBtn" class="btn btn-outline-secondary">Clear</button>
    </div>
  </form>
  <div class="form-text mt-2">This is a client-side simulated chatbot. Responses are generated locally.</div>
</div>

<!-- Bootstrap JS and dependencies -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
(function(){
  const chatEl = document.getElementById('chat');
  const form = document.getElementById('chatForm');
  const input = document.getElementById('messageInput');
  const clearBtn = document.getElementById('clearBtn');
  const STORAGE_KEY = 'simpleChatHistory_v1';

  function renderMessage(text, sender){
    const div = document.createElement('div');
    div.className = 'message';
    const p = document.createElement('div');
    p.className = 'p-2 d-inline-block rounded ' + (sender==='user' ? 'bg-primary text-white' : 'bg-light text-dark');
    p.textContent = text;
    if(sender==='user'){
      p.classList.add('text-end');
      div.classList.add('msg-user', 'd-flex', 'justify-content-end');
    } else {
      div.classList.add('msg-bot', 'd-flex', 'justify-content-start');
    }
    div.appendChild(p);
    chatEl.appendChild(div);
    chatEl.scrollTop = chatEl.scrollHeight;
  }

  function botResponseFor(text){
    // simple simulated response rules
    const t = text.trim();
    if(!t) return '';
    if(/help|how|what|why|when|where|\?/.test(t.toLowerCase())){
      return "Simulated answer: I understood you asked about \"" + t + "\". Here's a concise helpful reply.";
    }
    if(t.length < 50){
      return "Thanks for the short description: \""+ t + "\". If you'd like an answer, try phrasing it as a question.";
    }
    // fallback summarization-like response
    return "Simulated summary: \"" + t.slice(0,120) + (t.length>120? '...': '') + "\" â€” I can help expand, clarify, or answer specific questions about this.";
  }

  function saveHistory(history){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
  }

  function loadHistory(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return [];
      return JSON.parse(raw);
    }catch(e){ return []; }
  }

  function appendAndRespond(text){
    const history = loadHistory();
    history.push({sender:'user', text, ts: Date.now()});
    saveHistory(history);
    renderMessage(text, 'user');

    // simulate thinking
    const thinking = document.createElement('div');
    thinking.className = 'message msg-bot d-flex justify-content-start';
    const dot = document.createElement('div');
    dot.className = 'p-2 bg-light text-muted rounded';
    dot.textContent = '...';
    thinking.appendChild(dot);
    chatEl.appendChild(thinking);
    chatEl.scrollTop = chatEl.scrollHeight;

    setTimeout(()=> {
      chatEl.removeChild(thinking);
      const resp = botResponseFor(text);
      history.push({sender:'bot', text:resp, ts: Date.now()});
      saveHistory(history);
      renderMessage(resp, 'bot');
    }, 700 + Math.random()*800);
  }

  form.addEventListener('submit', function(e){
    e.preventDefault();
    const val = input.value.trim();
    if(!val) return;
    appendAndRespond(val);
    input.value = '';
    input.focus();
  });

  clearBtn.addEventListener('click', function(){
    localStorage.removeItem(STORAGE_KEY);
    chatEl.innerHTML = '';
    input.focus();
  });

  // load on start
  (function init(){
    const history = loadHistory();
    history.forEach(item => renderMessage(item.text, item.sender));
    input.focus();
  })();

})();
</script>
</body>
</html>
